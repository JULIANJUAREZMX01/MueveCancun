---
---
<div class="sunny-card p-8 animate-fade-in relative overflow-hidden" id="driver-wallet">
  <div class="absolute top-0 right-0 p-4 opacity-10">
    <span class="text-8xl">üí≥</span>
  </div>

  <h2 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-1">Tu Saldo Actual</h2>
  <div class="flex items-baseline gap-2 mb-6">
    <span id="wallet-amount" class="text-5xl font-black text-deep-navy tracking-tighter">$0</span>
    <span class="text-xl font-bold text-gray-400">MXN</span>
  </div>

  <div class="space-y-4 relative z-10">
    <p class="text-[10px] font-bold text-gray-400 uppercase text-center mb-2">Recarga R√°pida (Simulaci√≥n)</p>
    <div class="grid grid-cols-3 gap-2">
      <button data-amount="50" class="top-up-btn bg-white border-2 border-gray-100 hover:border-primary-500 hover:text-primary-600 text-gray-500 font-black py-2 rounded-xl transition-all shadow-sm active:scale-95 text-xs">
        +$50
      </button>
      <button data-amount="100" class="top-up-btn bg-white border-2 border-gray-100 hover:border-primary-500 hover:text-primary-600 text-gray-500 font-black py-2 rounded-xl transition-all shadow-sm active:scale-95 text-xs">
        +$100
      </button>
      <button data-amount="200" class="top-up-btn bg-white border-2 border-gray-100 hover:border-primary-500 hover:text-primary-600 text-gray-500 font-black py-2 rounded-xl transition-all shadow-sm active:scale-95 text-xs">
        +$200
      </button>
    </div>

    <div class="mt-6 pt-6 border-t border-dashed border-gray-200">
      <div class="flex justify-between items-center text-xs font-bold text-gray-500 mb-2">
        <span>Estado de Cuenta</span>
        <span class="text-green-600">‚óè Activo</span>
      </div>
      <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
        <div class="h-full bg-primary-500 w-[85%] rounded-full"></div>
      </div>
    </div>
  </div>
</div>

<script>
  import { openDB } from 'idb';

  const elAmount = document.getElementById('wallet-amount');
  const btns = document.querySelectorAll('.top-up-btn');
  const DB_NAME = 'cancunmueve-db';

  async function getDB() {
    return openDB(DB_NAME, 2, {
      upgrade(db) {
         if (!db.objectStoreNames.contains('wallet-status')) {
            db.createObjectStore('wallet-status');
         }
      },
    });
  }

  async function updateBalanceDisplay() {
    const db = await getDB();
    const bal = await db.get('wallet-status', 'driver_current');
    elAmount.innerText = `$${Number(bal || 0).toFixed(0)}`;
  }

  async function addFunds(amount) {
    const db = await getDB();
    const current = Number(await db.get('wallet-status', 'driver_current') || 0);
    const newBal = current + Number(amount);
    await db.put('wallet-status', newBal, 'driver_current');
    await updateBalanceDisplay();
    
    // Animate
    elAmount.classList.add('text-green-500', 'scale-110');
    setTimeout(() => {
        elAmount.classList.remove('text-green-500', 'scale-110');
    }, 300);
  }

  // Init
  updateBalanceDisplay();

  // Listeners
  btns.forEach(btn => {
    btn.addEventListener('click', (e) => {
      const amt = e.target.dataset.amount;
      if (amt) addFunds(amt);
    });
  });
</script>
