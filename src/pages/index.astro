---
import MainLayout from '../layouts/MainLayout.astro';
import RouteCalculator from '../components/RouteCalculator.astro';
---

<MainLayout title="Inicio">
  <div class="space-y-8 animate-fade-in">
    <!-- Hero / Greeting -->
    <section class="text-center pt-6 pb-2">
      <h1 class="text-3xl font-display font-black text-deep-navy tracking-tight mb-2 flex justify-center">
        <span class="brand-container" data-original="true">CancÃºn<span class="text-primary-500">Mueve</span></span>
      </h1>
      <p class="text-slate-500 font-medium">
        Encuentra la mejor ruta en transporte pÃºblico.
      </p>
    </section>

    <script is:inline>
      // Define handler globally so reference is stable for removal
      window.handleBrandUpdate = window.handleBrandUpdate || ((e) => {
          const phase = e.detail.phase;
          const containers = document.querySelectorAll('.brand-container');

          containers.forEach(container => {
              if (phase === 1) {
                  // CancÃºn -> CancÃºnENMueve
                  if (container.dataset.phase === '1') return;
                  container.innerHTML = `CancÃºn<span class="text-[#006847] animate-pop-in inline-block mx-[1px]">EN</span><span class="text-primary-500">Mueve</span>`;
                  container.dataset.phase = '1';
              } else if (phase === 2) {
                  // -> CancÃºnENMueveTE
                  if (container.dataset.phase === '2') return;
                  // Ensure base state first if jumped
                  container.innerHTML = `CancÃºn<span class="text-[#006847] mx-[1px]">EN</span><span class="text-primary-500">Mueve</span><span class="text-[#CE1126] animate-pop-in inline-block">TE</span>`;
                  container.dataset.phase = '2';
              } else if (phase === 3) {
                  // Tetris -> Â¡MUEVETE EN CANCUN!
                  if (container.dataset.phase === '3') return;

                  container.innerHTML = `
                    <div class="flex items-center gap-1.5 leading-none">
                        <span class="text-[#006847] animate-tetris-1">Â¡MUEVETE</span>
                        <span class="text-slate-900 bg-white border border-slate-900 px-1 rounded text-[0.8em] animate-tetris-2 self-center">EN</span>
                        <span class="text-[#CE1126] animate-tetris-3">CANCUN!</span>
                    </div>
                  `;
                  container.dataset.phase = '3';
              }
          });
      });

      document.addEventListener('astro:page-load', () => {
          // Remove potential existing listener to avoid duplicates
          window.removeEventListener('BRAND_UPDATE', window.handleBrandUpdate);
          window.addEventListener('BRAND_UPDATE', window.handleBrandUpdate);
      });
    </script>

    <style is:global>
      @keyframes pop-in {
        0% { transform: scale(0); opacity: 0; }
        80% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); }
      }
      .animate-pop-in { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

      @keyframes fall-down {
        0% { transform: translateY(-20px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
      }
      .animate-tetris-1 { animation: fall-down 0.5s ease-out forwards; display: inline-block; }
      .animate-tetris-2 { animation: fall-down 0.5s ease-out 0.2s forwards; opacity: 0; display: inline-block; }
      .animate-tetris-3 { animation: fall-down 0.5s ease-out 0.4s forwards; opacity: 0; display: inline-block; }
    </style>

    <!-- Calculator Widget -->
    <section>
      <RouteCalculator />
    </section>

    <!-- Catalog Link -->
    <section class="text-center pt-2">
      <a href="/rutas" class="inline-flex items-center gap-2 text-sm font-bold text-slate-500 hover:text-primary-600 transition-colors border-b border-transparent hover:border-primary-600 pb-0.5">
        <span>ðŸšŒ</span> Ver todas las rutas
      </a>
    </section>

    <!-- Promo / Info (Subtle) -->
    <section class="text-center py-8 opacity-60">
      <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">
        Powered by RouteEngineâ„¢ v2.2 WASM
      </p>
    </section>
  </div>
</MainLayout>
